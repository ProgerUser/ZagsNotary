<?xml version="1.0" encoding="utf-8" standalone="no"?>
<TfrxReport Version="6.5.1" DotMatrixReport="false" IniFile="\Software\Fast Reports" PreviewOptions.Buttons="4095" PreviewOptions.Zoom="1" PrintOptions.Printer="Default" PrintOptions.PrintOnSheet="0" ReportOptions.CreateDate="39553,4200421296" ReportOptions.Description.Text="" ReportOptions.LastChange="44203,5595627778" ScriptLanguage="PascalScript" ScriptText.Text="Var&#13;&#10;  REP_TP_ID :Integer;&#13;&#10;  REP_TP_CNT :  Integer;&#13;&#10;  REP_CAT_CNT :  Integer;&#13;&#10;&#13;&#10;procedure usr_likeOnChange(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  usr_list.close;&#13;&#10;  usr_list.open;&#13;&#10;end;&#13;&#10;&#13;&#10;procedure usr_likeOnKeyPress(Sender: TfrxComponent; var Key: Char);&#13;&#10;begin&#13;&#10;  usr_list.close;&#13;&#10;  usr_list.open;&#13;&#10;end;&#13;&#10;&#13;&#10;procedure rep_tp_likeOnChange(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  ap_rep_tp.close;&#13;&#10;  ap_rep_tp.open;&#13;&#10;end;&#13;&#10;&#13;&#10;procedure rep_tp_likeOnKeyPress(Sender: TfrxComponent; var Key: Char);&#13;&#10;begin&#13;&#10;  ap_rep_tp.close;&#13;&#10;  ap_rep_tp.open;&#13;&#10;end;&#13;&#10;&#13;&#10;procedure rep_cat_likeOnChange(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  ap_rep_cat.close;&#13;&#10;  ap_rep_cat.open;&#13;&#10;end;&#13;&#10;&#13;&#10;procedure rep_cat_likeOnKeyPress(Sender: TfrxComponent; var Key: Char);&#13;&#10;begin&#13;&#10;  ap_rep_cat.close;&#13;&#10;  ap_rep_cat.open;&#13;&#10;end;&#13;&#10;&#13;&#10;procedure usr_lstOnKeyUp(Sender: TfrxComponent; var Key: Word; Shift: Integer);&#13;&#10;begin&#13;&#10;  ap_rep_tp.close;&#13;&#10;  ap_rep_tp.open;&#13;&#10;end;&#13;&#10;&#13;&#10;procedure rep_tp_accOnClick(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  if (rep_tp_acc.Checked) and (REP_TP_CNT = 0) and (ap_rep.Text &#60;&#62; '') then&#13;&#10;  begin&#13;&#10;    ShowMessage(ExecPLSQL('begin insert into AP_USER_REPORT_ROLE (USER_ID,REPORT_TYPE_ID) values ('''+IntToStr(&#60;usr_list.&#34;IUSRID&#34;&#62;)+''','''+IntToStr(&#60;ap_rep_tp.&#34;ID&#34;&#62;)+'''); commit; end;'));&#13;&#10;  end;&#13;&#10;  if (not rep_tp_acc.Checked) and (REP_TP_CNT = 1) and (ap_rep.Text &#60;&#62; '') then&#13;&#10;  begin&#13;&#10;    ShowMessage(ExecPLSQL('begin delete from AP_USER_REPORT_ROLE where USER_ID = '''+IntToStr(&#60;usr_list.&#34;IUSRID&#34;&#62;)+''' and REPORT_TYPE_ID = '''+IntToStr(&#60;ap_rep_tp.&#34;ID&#34;&#62;)+'''; commit; end;'));&#13;&#10;  end;&#13;&#10;end;&#13;&#10;&#13;&#10;&#13;&#10;&#13;&#10;procedure usr_lstOnClick(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  {ShowMessage('OnClick');}&#13;&#10;  ap_rep_tp.close;&#13;&#10;  ap_rep_tp.open;&#13;&#10;&#13;&#10;  ap_rep_cat.close;&#13;&#10;  ap_rep_cat.open;&#13;&#10;&#13;&#10;  REP_TP();&#13;&#10;  REP_TP_CAT();&#13;&#10;end;&#13;&#10;&#13;&#10;//Проверка доступа по типам отчетов&#13;&#10;procedure REP_TP();&#13;&#10;BEGIN&#13;&#10;  if ap_rep.Text &#60;&#62; '' then&#13;&#10;  begin&#13;&#10;    ap_rep_tp_access.close;&#13;&#10;    ap_rep_tp_access.open;&#13;&#10;    while not ap_rep_tp_access.Eof do&#13;&#10;    begin&#13;&#10;      REP_TP_CNT := ap_rep_tp_access.FieldByName('CNT').AsInteger;&#13;&#10;      ap_rep_tp_access.next;&#13;&#10;    end;&#13;&#10;&#13;&#10;    if REP_TP_CNT = 1 then&#13;&#10;    begin&#13;&#10;      rep_tp_acc.Checked := true;&#13;&#10;    end&#13;&#10;    else&#13;&#10;    begin&#13;&#10;      rep_tp_acc.Checked := false;&#13;&#10;    end;&#13;&#10;  end;&#13;&#10;END;&#13;&#10;&#13;&#10;//Проверка доступа по отчетам&#13;&#10;procedure REP_TP_CAT();&#13;&#10;BEGIN&#13;&#10;  if ap_cat.Text &#60;&#62; '' then&#13;&#10;  begin&#13;&#10;    ap_rep_cat_access.close;&#13;&#10;    ap_rep_cat_access.open;&#13;&#10;    while not ap_rep_cat_access.Eof do&#13;&#10;    begin&#13;&#10;      REP_CAT_CNT := ap_rep_cat_access.FieldByName('CNT').AsInteger;&#13;&#10;      ap_rep_cat_access.next;&#13;&#10;    end;&#13;&#10;&#13;&#10;    if REP_CAT_CNT = 1 then&#13;&#10;    begin&#13;&#10;      rep_cat_acc.Checked := true;&#13;&#10;    end&#13;&#10;    else&#13;&#10;    begin&#13;&#10;      rep_cat_acc.Checked := false;&#13;&#10;    end;&#13;&#10;  end;&#13;&#10;END;&#13;&#10;&#13;&#10;procedure ap_repOnClick(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  ap_rep_cat.close;&#13;&#10;  ap_rep_cat.open;&#13;&#10;  REP_TP();&#13;&#10;  //ShowMessage(ap_rep.Text);&#13;&#10;end;&#13;&#10;&#13;&#10;procedure ap_catOnClick(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  REP_TP_CAT();&#13;&#10;end;&#13;&#10;&#13;&#10;procedure rep_cat_accOnClick(Sender: TfrxComponent);&#13;&#10;begin&#13;&#10;  if (rep_cat_acc.Checked) and (REP_CAT_CNT = 0) and (ap_cat.Text &#60;&#62; '') then&#13;&#10;  begin&#13;&#10;    ShowMessage(ExecPLSQL('begin insert into AP_USER_REPORT_CAT_ROLE (USER_ID,REPORT_TYPE_ID,REPORT_ID) values ('''+IntToStr(&#60;usr_list.&#34;IUSRID&#34;&#62;)+''','''+IntToStr(&#60;ap_rep_cat.&#34;REPORT_TYPE_ID&#34;&#62;)+''','''+IntToStr(&#60;ap_rep_cat.&#34;REPORT_TYPE_ID&#34;&#62;)+'''); commit; end;'));&#13;&#10;  end;&#13;&#10;  if (not rep_cat_acc.Checked) and (REP_CAT_CNT = 1) and (ap_cat.Text &#60;&#62; '') then&#13;&#10;  begin&#13;&#10;    ShowMessage(ExecPLSQL('begin delete from AP_USER_REPORT_CAT_ROLE where USER_ID = '''+IntToStr(&#60;usr_list.&#34;IUSRID&#34;&#62;)+''' and REPORT_TYPE_ID = '''+IntToStr(&#60;ap_rep_cat.&#34;REPORT_TYPE_ID&#34;&#62;)+'''  and REPORT_ID = '''+IntToStr(&#60;ap_rep_cat.&#34;ID&#34;&#62;)+'''; commit; end;'));&#13;&#10;  end;&#13;&#10;end;&#13;&#10;&#13;&#10;begin&#13;&#10;&#13;&#10;  usr_list.close;&#13;&#10;  usr_list.open;&#13;&#10;&#13;&#10;end.&#13;&#10;">
  <Datasets>
    <item DataSet="usr_list" DataSetName="usr_list"/>
    <item DataSet="ap_rep_tp" DataSetName="ap_rep_tp"/>
    <item DataSet="ap_rep_cat" DataSetName="ap_rep_cat"/>
    <item DataSet="ap_rep_tp_access" DataSetName="ap_rep_tp_access"/>
    <item DataSet="ap_rep_cat_access" DataSetName="ap_rep_cat_access"/>
  </Datasets>
  <Variables>
    <item Name=" XXI"/>
    <item Name="SID" Value="'1790133'"/>
    <item Name="P1" Value="NULL"/>
    <item Name="P2" Value="''"/>
    <item Name="P3" Value="''"/>
    <item Name="P4" Value="''"/>
    <item Name="P5" Value="''"/>
    <item Name="P6" Value="''"/>
    <item Name="P7" Value="''"/>
    <item Name="P8" Value="''"/>
    <item Name="P9" Value="''"/>
    <item Name="P10" Value="''"/>
    <item Name="REPORT_TYPE_ID" Value="'1'"/>
    <item Name="REPORT_ID" Value="'4'"/>
    <item Name="UserName" Value="'xxi'"/>
    <item Name="Password" Value="''"/>
    <item Name="Database" Value="'xe'"/>
    <item Name="ConnectString" Value="''"/>
    <item Name="DLL_PATH" Value="'C:\MJ_\bin\'"/>
  </Variables>
  <TfrxDataPage Name="Data" Height="1000" Left="0" Top="0" Width="1000">
    <TfrxODACQuery Name="usr_list" UserName="usr_list" CloseDataSource="true" FieldAliases.Text="ID=ID&#13;&#10;NAME=NAME&#13;&#10;IUSRID=IUSRID" BCDToCurrency="false" IgnoreDupParams="false" SQL.Text="select *&#13;&#10;  from (select CUSRLOGNAME ID, CUSRLOGNAME || ' : ' || CUSRNAME NAME,IUSRID    &#13;&#10;          from USR t)&#13;&#10; where (:usr_like is null or&#13;&#10;       lower(NAME) like '%' || lower(:usr_like) || '%')&#13;&#10;                                     " PropData="05704C65667402700470546F7002580A506172616D65746572730101063F204E616D653D227573725F6C696B65222044617461547970653D226674537472696E67222045787072657373696F6E3D227573725F6C696B652E54657874220001063F204E616D653D227573725F6C696B65222044617461547970653D226674537472696E67222045787072657373696F6E3D227573725F6C696B652E54657874220000"/>
    <TfrxODACQuery Name="ap_rep_tp" UserName="ap_rep_tp" CloseDataSource="true" FieldAliases.Text="ID=ID&#13;&#10;NAME=NAME" BCDToCurrency="false" IgnoreDupParams="false" SQL.Text="select *&#13;&#10;  from (select REPORT_TYPE_ID ID, REPORT_TYPE_ID || ' : ' || REPORT_TYPE_NAME NAME&#13;&#10;          from AP_REPORT_TYPE t)&#13;&#10; where (:rep_tp_like is null or&#13;&#10;       lower(NAME) like '%' || lower(:rep_tp_like) || '%')  " PropData="05704C65667403B0000470546F7002580A506172616D657465727301010645204E616D653D227265705F74705F6C696B65222044617461547970653D226674537472696E67222045787072657373696F6E3D227265705F74705F6C696B652E546578742200010645204E616D653D227265705F74705F6C696B65222044617461547970653D226674537472696E67222045787072657373696F6E3D227265705F74705F6C696B652E54657874220000"/>
    <TfrxODACQuery Name="ap_rep_cat" UserName="ap_rep_cat" CloseDataSource="true" FieldAliases.Text="ID=ID&#13;&#10;NAME=NAME&#13;&#10;REPORT_TYPE_ID=REPORT_TYPE_ID" BCDToCurrency="false" IgnoreDupParams="false" SQL.Text="select *&#13;&#10;  from (select REPORT_ID ID, REPORT_ID || ' : ' || REPORT_NAME NAME,REPORT_TYPE_ID&#13;&#10;          from AP_REPORT_CAT t)&#13;&#10; where (:rep_tp_like is null or&#13;&#10;       lower(NAME) like '%' || lower(:rep_tp_like) || '%')&#13;&#10; and REPORT_TYPE_ID = :rep_tp_id  " PropData="05704C65667403FC000470546F7002580A506172616D657465727301010646204E616D653D227265705F74705F6C696B65222044617461547970653D226674537472696E67222045787072657373696F6E3D227265705F6361745F6C696B652E546578742200010646204E616D653D227265705F74705F6C696B65222044617461547970653D226674537472696E67222045787072657373696F6E3D227265705F6361745F6C696B652E546578742200010654204E616D653D227265705F74705F6964222044617461547970653D226674496E7465676572222045787072657373696F6E3D22262336303B61705F7265705F74702E262333343B4944262333343B262336323B220000"/>
    <TfrxODACQuery Name="ap_rep_tp_access" UserName="ap_rep_tp_access" CloseDataSource="true" FieldAliases.Text="CNT=CNT" BCDToCurrency="false" IgnoreDupParams="false" SQL.Text="select count(*) CNT&#13;&#10;  from AP_USER_REPORT_ROLE t&#13;&#10; where t.user_id = :usr_id&#13;&#10;   and REPORT_TYPE_ID = :rep_tp_id  " PropData="05704C65667402700470546F7003A0000A506172616D657465727301010654204E616D653D227573725F6964222044617461547970653D226674496E7465676572222045787072657373696F6E3D22262336303B7573725F6C6973742E262333343B495553524944262333343B262336323B2200010654204E616D653D227265705F74705F6964222044617461547970653D226674496E7465676572222045787072657373696F6E3D22262336303B61705F7265705F74702E262333343B4944262333343B262336323B220000"/>
    <TfrxODACQuery Name="ap_rep_cat_access" UserName="ap_rep_cat_access" CloseDataSource="true" FieldAliases.Text="" BCDToCurrency="false" IgnoreDupParams="false" SQL.Text="select count(*) CNT&#13;&#10;  from AP_USER_REPORT_CAT_ROLE t&#13;&#10; where t.user_id = :usr_id&#13;&#10;   and REPORT_TYPE_ID = :rep_tp_id&#13;&#10;   and REPORT_ID = :rep_id  " PropData="05704C65667403E4000470546F7003A0000A506172616D657465727301010654204E616D653D227573725F6964222044617461547970653D226674496E7465676572222045787072657373696F6E3D22262336303B7573725F6C6973742E262333343B495553524944262333343B262336323B2200010654204E616D653D227265705F74705F6964222044617461547970653D226674496E7465676572222045787072657373696F6E3D22262336303B61705F7265705F74702E262333343B4944262333343B262336323B2200010652204E616D653D227265705F6964222044617461547970653D226674496E7465676572222045787072657373696F6E3D22262336303B61705F7265705F6361742E262333343B4944262333343B262336323B220000"/>
  </TfrxDataPage>
  <TfrxDialogPage Name="DialogPage1" Font.Charset="1" Font.Color="-16777208" Font.Height="-13" Font.Name="Arial" Font.Style="0" DoubleBuffered="false" Height="391" ClientHeight="352" Left="520" Top="206" Width="438" Scaled="true" ClientWidth="422">
    <TfrxGroupBoxControl Name="GroupBox4" Left="8" Top="8" Width="293" Height="81" ShowHint="true" Caption="Пользователь" Color="-16777201">
      <TfrxEditControl Name="usr_like" Left="8" Top="20" Width="277" Height="25" Hint="Часть логина или ФИО пользователя" ShowHint="true" Color="-16777211" MaxLength="0" PasswordChar="0" OnChange="usr_likeOnChange" OnKeyPress="usr_likeOnKeyPress"/>
      <TfrxDBLookupComboBox Name="usr_lst" Left="8" Top="48" Width="277" Height="25" Hint="Список пользователей" ShowHint="true" DataSet="usr_list" DataSetName="usr_list" ListField="NAME" KeyField="ID" DropDownWidth="0" DropDownRows="7" OnClick="usr_lstOnClick"/>
    </TfrxGroupBoxControl>
    <TfrxGroupBoxControl Name="GroupBox1" Left="8" Top="96" Width="397" Height="117" ShowHint="true" Caption="Список типов отчетов" Color="-16777201">
      <TfrxEditControl Name="rep_tp_like" Left="8" Top="24" Width="385" Height="25" ShowHint="true" Color="-16777211" MaxLength="0" PasswordChar="0" OnChange="rep_tp_likeOnChange" OnKeyPress="rep_tp_likeOnKeyPress"/>
      <TfrxDBLookupComboBox Name="ap_rep" Left="8" Top="60" Width="385" Height="25" ShowHint="true" DataSet="ap_rep_tp" DataSetName="ap_rep_tp" ListField="NAME" KeyField="ID" DropDownWidth="0" DropDownRows="7" OnClick="ap_repOnClick"/>
      <TfrxCheckBoxControl Name="rep_tp_acc" Left="8" Top="92" Width="97" Height="17" ShowHint="true" Caption="Доступность" Color="-16777201" OnClick="rep_tp_accOnClick"/>
    </TfrxGroupBoxControl>
    <TfrxGroupBoxControl Name="GroupBox2" Left="8" Top="228" Width="397" Height="109" ShowHint="true" Caption="Список отчетов" Color="-16777201">
      <TfrxEditControl Name="rep_cat_like" Left="8" Top="24" Width="385" Height="25" ShowHint="true" Color="-16777211" MaxLength="0" PasswordChar="0" OnChange="rep_cat_likeOnChange" OnKeyPress="rep_cat_likeOnKeyPress"/>
      <TfrxDBLookupComboBox Name="ap_cat" Left="8" Top="56" Width="385" Height="25" ShowHint="true" DataSet="ap_rep_cat" DataSetName="ap_rep_cat" ListField="NAME" KeyField="ID" DropDownWidth="0" DropDownRows="7" OnClick="ap_catOnClick"/>
      <TfrxCheckBoxControl Name="rep_cat_acc" Left="8" Top="84" Width="97" Height="17" ShowHint="true" Caption="Доступность" Color="-16777201" OnClick="rep_cat_accOnClick"/>
    </TfrxGroupBoxControl>
  </TfrxDialogPage>
</TfrxReport>
